function KellyTetris(a,b){function t(){g=new Array(10);for(var a=0;a<g.length;a++)g[a]=new Array(20)}function u(a){h[a]=Math.floor(Math.random()*c.length),f[a]=c[h[a]].slice()}function v(a,b){var c=f[0];if(b&&h[0]>0){for(var d=[],e=0;e<c.length;e++)d[e]=[-1*c[e][1],c[e][0]];c=d}for(var e=0;e<c.length;e++){if(a[1]+c[e][1]>=g[0].length)return!0;if(a[0]+c[e][0]<0||a[0]+c[e][0]>=g.length)return!0;if(g[a[0]+c[e][0]][a[1]+c[e][1]])return!0}return b&&h[0]>0&&(f[0]=d),!1}function w(){var a=[i[0],i[1]+1];if(v(a)){for(var b=f[0],c=0;c<b.length;c++)g[i[0]+b[c][0]][i[1]+b[c][1]]=f[0]+1;y()}else i=a;for(var d=0,e=0;e<g[0].length;e++){for(var h=0,j=0;j<10;j++)g[j][e]&&h++;if(10==h){for(var j=0;j<10;j++)g[j].splice(e,1),g[j].splice(0,0,0);d++}}m+=100*d*d;var k=l-50*Math.floor(m/400);k<70&&(k=70),n=k}function x(){if(k)return void(a.innerHTML="game over<br>total score : "+m+'<br><br><br><br>press UP to restart<br>press DOWN to EXIT<br><br><br><br><a href="https://github.com/NC22">github</a> (c) NC22 2016');for(var b="",c=0;c<g[0].length;c++){for(var d=0;d<10;d++){for(var e=!1,h=f[0],j=0;j<h.length;j++)if(i[0]+h[j][0]==d&&i[1]+h[j][1]==c){b+="[]",e=!0;break}e||(b+=g[d][c]?"[]":". ")}if(3==c&&(b+="  next : "),c>=5&&c<=8){b+="  ";for(var l=1-(c-5),n=-2;n<2;n++){for(var o=!1,j=0;j<f[1].length;j++)if(n==f[1][j][0]&&l==f[1][j][1]){b+="[]",o=!0;break}o||(b+=". ")}}10==c&&(b+="  score : "+m),b+="<br>"}a.innerHTML=b}function y(){i=new Array,i[0]=j[0],i[1]=j[1],f[1]?(f[0]=f[1].slice(),h[0]=h[1]):u(0),u(1),s=0,r=0,q=0,v(i)&&(k=!0)}var g,i,o,p,c=[[[0,0],[-1,0],[-1,-1],[0,-1]],[[0,0],[0,-1],[1,0],[1,1]],[[0,0],[0,-1],[0,1],[1,1]],[[0,0],[0,1],[1,0],[1,-1]],[[0,0],[0,1],[0,-1],[0,-2]],[[0,0],[1,0],[0,1],[-1,0]],[[0,0],[0,-1],[0,1],[-1,1]]],d=this,a=document.getElementById(a),e=b,f=new Array(2),h=new Array(2),j=[4,0],k=!1,l=350,m=0,n=0,q=0,r=0,s=0;document.body.onkeydown=function(a){var b=a.keyCode-36;return k&&2==b?void d.restart():k&&4==b?void d.stop():(2==b&&(q=1),4==b&&(r=1),1==b&&(s=-1),void(3==b&&(s=1)))},this.restart=function(){m=0,k=!1,t(),y(),d.process(),x()},this.process=function(){o&&(p=Date.now()-o,n-=p),(s||r||q)&&(v([i[0]+s,i[1]+r],q)||(i=[i[0]+s,i[1]+r]),s=0,r=0,q=0,x()),o=Date.now(),n<=0&&(w(),x()),k||window.requestAnimationFrame(function(){d.process()})},this.stop=function(){k=!0,document.body.onkeydown=!1,e&&e(d)},d.restart()}KellyTetris.consoleUpdateCursor=function(a){if(a.cursor){var b=a.cursor;b.style.opacity=0,setTimeout(function(){b.parentNode.removeChild(b)},500),a.cursor=!1}else a.cursor||(a.cursor=document.createElement("span"),a.cursor.style.transition="all 1s",a.cursor.style.opacity="1",a.cursor.innerHTML="_",a.screen.appendChild(a.cursor))},KellyTetris.consoleType=function(a){if(a.starttext&&(a.screen.innerHTML+=a.starttext,a.starttext=""),!(a.delayAfter||a.text&&a.text.length))return a.screen.innerHTML+="<br>",void(a.onEnd&&a.onEnd(a));if(a.screen){var b;a.delayBefore>0?(a.delayBefore--,b=500,KellyTetris.consoleUpdateCursor(a)):a.text?(a.screen.innerHTML+=a.text.slice(0,1),a.text=a.text.slice(1,a.text.length),b=80*(2+Math.floor(8*Math.random()))):a.delayAfter>0&&(a.delayAfter--,b=500,KellyTetris.consoleUpdateCursor(a)),setTimeout(function(){KellyTetris.consoleType(a)},b)}},KellyTetris.playMe=function(){var a=document.body,b=document.getElementsByTagName("html")[0];b.style.padding="0px",b.style.margin="0px",b.style.height="100%",b.style.width="100%",a.style.padding="0px",a.style.margin="0px";var c=document.createElement("div");c.style.backgroundColor="rgba(0, 0, 0, 0.8)",c.style.position="absolute",c.style.width="100%",c.style.height="100%",c.style.left="0px",c.style.top="0px",c.style.opacity=0,c.style.cursor="default",c.style.zIndex="9999",c.style.transition="opacity 1s";var d=document.createElement("pre");d.style.wordWrap="break-word",d.style.whiteSpace="pre-wrap",d.style.fontSize="12px;",d.style.padding="0",d.style.margin="0",d.style.paddingLeft="12px",d.style.paddingTop="12px",d.style.display="block",d.style.color="#10ea10",d.style.border="0px",d.style.background="transparent",d.id="tris",d.style.minHeight="0px",c.appendChild(d),a.appendChild(c),setTimeout(function(){c.style.opacity=1,KellyTetris.consoleType({starttext:"A:\\>",text:"tetris.exe",delayBefore:12,delayAfter:10,screen:d,onEnd:function(){d.innerHTML="";new KellyTetris("tris",function(){c.style.opacity=0,setTimeout(function(){a.removeChild(c)},1e3)})}})},100)};